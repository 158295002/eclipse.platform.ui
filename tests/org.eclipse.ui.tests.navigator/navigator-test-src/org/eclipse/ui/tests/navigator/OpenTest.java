/***************************************************************************************************
 * Copyright (c) 2003, 2004 IBM Corporation and others. All rights reserved. This program and the
 * accompanying materials are made available under the terms of the Eclipse Public License v1.0
 * which accompanies this distribution, and is available at
 * http://www.eclipse.org/legal/epl-v10.html
 * 
 * Contributors: IBM Corporation - initial API and implementation
 **************************************************************************************************/
package org.eclipse.ui.tests.navigator;

import junit.framework.Assert;
import junit.framework.TestCase;

import org.eclipse.core.resources.IProject;
import org.eclipse.core.resources.ResourcesPlugin;
import org.eclipse.jface.viewers.StructuredSelection;
import org.eclipse.swt.widgets.Display;
import org.eclipse.swt.widgets.Event;
import org.eclipse.swt.widgets.TreeItem;
import org.eclipse.ui.IViewPart;
import org.eclipse.ui.IWorkbenchPage;
import org.eclipse.ui.IWorkbenchWindow;
import org.eclipse.ui.PlatformUI;
import org.eclipse.ui.navigator.CommonViewer;

public class OpenTest extends TestCase {

	public static final String COMMON_NAVIGATOR_INSTANCE_ID= "org.eclipse.ui.examples.navigator.example1"; //$NON-NLS-1$

	public void testOpenNavigator() throws Exception {
		EditorTestHelper.showView(COMMON_NAVIGATOR_INSTANCE_ID, true);

		IWorkbenchWindow activeWindow= PlatformUI.getWorkbench().getActiveWorkbenchWindow();
		IWorkbenchPage activePage= activeWindow.getActivePage(); 
		
		IViewPart commonNavigator= activePage.findView(COMMON_NAVIGATOR_INSTANCE_ID);
		
		assertNotNull(commonNavigator);
		
		activePage.activate(commonNavigator);
		
		CommonViewer viewer= (CommonViewer) commonNavigator.getAdapter(CommonViewer.class);
		
		assertNotNull(viewer);
		
		TreeItem[] items= viewer.getTree().getItems();
				
		assertTrue("There should be some items.", items.length > 0); //$NON-NLS-1$
		
		viewer.setSelection(new StructuredSelection(items[0].getData()));
 
	}
	

	public void testNavigatorRootContents() throws Exception {
		EditorTestHelper.showView(COMMON_NAVIGATOR_INSTANCE_ID, true);

		IWorkbenchWindow activeWindow= PlatformUI.getWorkbench().getActiveWorkbenchWindow();
		IWorkbenchPage activePage= activeWindow.getActivePage(); 

		IViewPart commonNavigator= activePage.findView(COMMON_NAVIGATOR_INSTANCE_ID);
		commonNavigator.setFocus();
		CommonViewer viewer= (CommonViewer) commonNavigator.getAdapter(CommonViewer.class);
		TreeItem[] items= viewer.getTree().getItems();
				
		assertTrue("There should be some items.", items.length > 0); //$NON-NLS-1$
		
		viewer.setSelection(new StructuredSelection(items[0].getData()));
		 
		IProject test = ResourcesPlugin.getWorkspace().getRoot().getProject("Test"); //$NON-NLS-1$
		assertEquals(test, items[0].getData());	 
	}
	

	private static void postEvent(final Display display, final Event event) {
		DisplayHelper helper= new DisplayHelper() {
			public boolean condition() {
				return display.post(event);
			}
		};
		Assert.assertTrue(helper.waitForCondition(display, 1000));			
	}
}
